var $,Board=function(){function n(){this.isDragging=!1;this.isFlipped=!1}return n.prototype.initBoard=function(){this.register()},n.prototype.register=function(){var n=this;$.post("/api/registerapi",function(t){return n.registered(t)})},n.prototype.registered=function(n){var t=this;this.userId=n;this.start();setInterval(function(){return t.getFiguresServer()},1e4);$(".newGame").click(function(){return t.newGameServer()});$(".flip").click(function(){return t.flipBoard()})},n.prototype.start=function(){this.map=new Array(64);this.addSquares();this.getFiguresServer()},n.prototype.flipBoard=function(){this.isFlipped=!this.isFlipped;this.start()},n.prototype.newGameServer=function(){var n=this;$.post("/api/newGame?userId="+this.userId,function(t){return n.showFigures(t)})},n.prototype.getFiguresServer=function(){var n=this;this.isDragging||$.post("/api/getfigures?userId="+this.userId,function(t){return n.showFigures(t)})},n.prototype.setDraggable=function(){var n=this;$(".figure").draggable({start:function(){n.isDragging=!0}})},n.prototype.setDroppable=function(){var n=this;$(".square").droppable({drop:function(t,i){var r=i.draggable.attr("id").substring(1),u=this.id.substring(1);n.moveFigure(r,u);n.moveFigureServer(r,u);n.isDragging=!1}})},n.prototype.moveFigure=function(n,t){var i=this.map[n];this.showFigureAt(n,"1");this.showFigureAt(t,i)},n.prototype.showFigures=function(n){for(var t=0;t<64;t++)this.showFigureAt(t,n[t])},n.prototype.addSquares=function(){var t,n;for($(".board").html(""),t='<div  id=s$coord class="square $color"><\/div>',n=0;n<64;n++)$(".board").append(t.replace("$coord",""+(this.isFlipped?63-n:n)).replace("$color",this.isBlackSquareAt(n)?"black":"white"));this.setDroppable()},n.prototype.isBlackSquareAt=function(n){return(n%8+Math.floor(n/8))%2!=0},n.prototype.gettChessSymbol=function(n){switch(n){case"K":return"&#9812;";case"Q":return"&#9813;";case"R":return"&#9814;";case"B":return"&#9815;";case"N":return"&#9816;";case"P":return"&#9817;";case"k":return"&#9818;";case"q":return"&#9819;";case"r":return"&#9820;";case"b":return"&#9821;";case"n":return"&#9822;";case"p":return"&#9823;";case"k":return"&#9824;"}return""},n.prototype.showFigureAt=function(n,t){if(this.map[n]!==t){this.map[n]=t;$("#s"+n).html("<div id=f$coord class=figure>$figure<\/div>".replace("$coord",""+n).replace("$figure",this.gettChessSymbol(t)));this.setDraggable()}},n.prototype.moveFigureServer=function(n,t){var i=this;$.post("/api/movefigure?fromCoord="+n+"&toCoord="+t+"&userId="+this.userId,function(n){return i.showFigures(n)})},n}();