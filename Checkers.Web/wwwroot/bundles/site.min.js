var $,Game=function(){function n(){}return n.prototype.initGame=function(){var t=this,n;this._serverRepository=new ServerRepository;this._gameDrawer=new GameDrawer;n=new BoardState;n.cells="1p1p1p1pp1p1p1p11p1p1p1p1111111111111111P1P1P1P11P1P1P1PP1P1P1P1";n.turn="w";n.mustGoFrom=null;this._gameDrawer.setNewGameClickHandler(function(){return t.showFiguresOnBoard(n)});this.initBoard(n)},n.prototype.initBoard=function(n){var t=this,i;this._figuresCache=new Array(n.cells.length);i=Math.sqrt(this._figuresCache.length);this._gameDrawer.drawSquares(i);this._gameDrawer.setDropFigureOnSquareHandler(function(n,i){t.moveFigureOnBoard(n,i);t._serverRepository.moveFigureOnServer(t._oldBoardState,n,i,function(n){return t.showFiguresOnBoard(n)})});this.showFiguresOnBoard(n)},n.prototype.moveFigureOnBoard=function(n,t){var i=this._figuresCache[n];this.showFigureAt(n,"1");this.showFigureAt(t,i)},n.prototype.showFiguresOnBoard=function(n){var i=this,t;for(this._oldBoardState=n,console.log(n),t=0;t<n.cells.length;t++)this.showFigureAt(t,n.cells[t]);n.turn==="b"&&this._serverRepository.intellectStep(this._oldBoardState,function(n){return i.intellectStepCalculated(n)})},n.prototype.intellectStepCalculated=function(n){for(var u=this,i=-1,r=-1,t=0;t<n.cells.length;t++)n.cells[t]=="1"&&(this._figuresCache[t]=="p"||this._figuresCache[t]=="q")&&(i=t),(n.cells[t]=="p"||n.cells[t]=="q")&&this._figuresCache[t]=="1"&&(r=t);i!==-1&&r!==-1?this._gameDrawer.drawMoving(i,r,function(){return u.showFiguresOnBoard(n)}):this.showFiguresOnBoard(n)},n.prototype.showFigureAt=function(n,t){this._figuresCache[n]!==t&&(this._figuresCache[n]=t,this._gameDrawer.drawFigure(n,t))},n}(),BoardDrawer=function(){function n(){}return n.prototype.drawBoard=function(n){var t=Math.min(document.documentElement.clientWidth,document.documentElement.clientHeight)-100;$(".board__inner").width(t);$(".board__inner").height(t);$(".board__inner").html(n)},n}(),SquareDrawer=function(){function n(){}return n.prototype.getSquaresHtml=function(n){for(var r,u,i="",t=0;t<n*n;t++)r=this.isBlackSquareAt(t,n)?"black":"white",u="<div id=s"+t+' class="square square_'+r+'" ><\/div>',i+=u;return i},n.prototype.setDropFigureOnSquareHandler=function(n){$(".square").droppable({drop:function(t,i){var r=i.draggable.attr("id").substring(1),u=this.id.substring(1);n(r,u)}})},n.prototype.isBlackSquareAt=function(n,t){return(n%t+Math.floor(n/t))%2!=0},n}(),FigureDrawer=function(){function n(){}return n.prototype.drawMoving=function(n,t,i){$("#f"+n).css("position","relative");$("#f"+n).css("z-index",100);var r=$("#s"+t).position().left-$("#s"+n).position().left,u=$("#s"+t).position().top-$("#s"+n).position().top;$("#f"+n).animate({left:r,top:u},500,i)},n.prototype.getHtml=function(n,t){return"<div id=f"+n+' class="figure figure_'+t+'"><\/div>'},n.prototype.setHandlers=function(n,t){(t=="P"||t=="Q")&&$("#f"+n).mousedown(function(){$(this).css("cursor","url(/images/movingCursor.cur), move")}).mouseup(function(){$(this).css("cursor","pointer")}).mouseleave(function(){$(this).css("cursor","pointer")}).draggable({start:function(){$(this).css("cursor","url(/images/movingCursor.cur), move")}})},n}(),RulesDrawer=function(){function n(){}return n.prototype.drawRules=function(){$(".rules__dialog").show();$(".rules__cover").show();$(".rules__close").click(function(){$(".rules__cover").hide();$(".rules__dialog").hide()})},n}(),GameDrawer=function(){function n(){this._squareDrawer=new SquareDrawer;this._figureDrawer=new FigureDrawer;this._boardDrawer=new BoardDrawer;this._rulesDrawer=new RulesDrawer}return n.prototype.setNewGameClickHandler=function(n){var t=this;$(".button__new").click(n);$(".button__rules").click(function(){return t._rulesDrawer.drawRules()})},n.prototype.drawSquares=function(n){var t=this._squareDrawer.getSquaresHtml(n);this._boardDrawer.drawBoard(t)},n.prototype.drawMoving=function(n,t,i){this._figureDrawer.drawMoving(n,t,i)},n.prototype.drawFigure=function(n,t){var i=this._figureDrawer.getHtml(n,t);$("#s"+n).html(i);this._figureDrawer.setHandlers(n,t)},n.prototype.setDropFigureOnSquareHandler=function(n){this._squareDrawer.setDropFigureOnSquareHandler(n)},n}(),BoardState=function(){function n(){}return n}(),ServerRepository=function(){function n(){}return n.prototype.moveFigureOnServer=function(n,t,i,r){$.post("/api/board/movefigure?fromCoord="+t+"&toCoord="+i+"&cells="+n.cells+"&turn="+n.turn+"&mustGoFrom"+n.mustGoFrom,r)},n.prototype.intellectStep=function(n,t){$.post("/api/intellect/calculatestep?cells="+n.cells+"&turn="+n.turn+"&mustGoFrom"+n.mustGoFrom,t)},n}();